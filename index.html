<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Investigador Privado</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üïµÔ∏è‚Äç‚ôÇÔ∏è</text></svg>">
<style>
  :root{
    --bg:#0c1424; --panel:#12203a; --text:#e8f1ff; --muted:#a8b6d4;
    --acc:#1f84ff; --acc-2:#00d4b7; --ok:#23d18b; --warn:#ffd166;
    --radius:16px; --shadow:0 14px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:linear-gradient(180deg,#0b1222 0%, #0a1328 100%);
    color:var(--text); font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
  }
  .wrap{min-height:100dvh; display:flex; flex-direction:column}

  /* HEADER */
  header{
    padding:12px 16px; border-bottom:1px solid #ffffff12;
    display:flex; align-items:center; justify-content:space-between;
  }
  .brand{display:flex; align-items:center; gap:10px; font-weight:700}
  .logo{
    width:32px; height:32px; border-radius:9px;
    background:radial-gradient(70% 70% at 25% 25%, #ffffff55 0 30%, transparent 31% 100%),
              linear-gradient(135deg, var(--acc), var(--acc-2));
    box-shadow:0 4px 16px #00c8ff33;
  }
  .icon-btn{
    -webkit-tap-highlight-color:transparent;
    width:38px; height:38px; display:grid; place-items:center;
    border-radius:12px; border:1px solid #ffffff20; background:#0f1a33; color:#d9e6ff;
    box-shadow:0 6px 18px rgba(0,0,0,.25); cursor:pointer;
  }
  .icon-btn svg{width:18px;height:18px;opacity:.95}

  /* MAIN */
  main{flex:1; display:flex; align-items:center; justify-content:center; padding:22px 14px;}
  .hero{
    width:min(980px,100%); background:linear-gradient(180deg,#121e36 0,#0e1830 100%);
    border:1px solid #ffffff14; border-radius:var(--radius); box-shadow:var(--shadow);
    padding:22px; margin-inline:auto; text-align:center;
  }
  .hero h1{margin:0 0 8px; font-size:clamp(22px,4.2vw,36px); line-height:1.15}
  .hero p{margin:0; color:var(--muted)}
  .cta{margin-top:18px; display:flex; flex-wrap:wrap; gap:12px; justify-content:center}
  .btn{
    -webkit-tap-highlight-color:transparent;
    display:inline-flex; align-items:center; justify-content:center; gap:10px;
    padding:14px 18px; border-radius:14px; border:1px solid #ffffff14;
    background:#0e1730; color:#e8f1ff; text-decoration:none; font-weight:700;
    box-shadow:0 6px 18px rgba(0,0,0,.25); transition:.25s transform,.25s border-color;
    min-width:230px;
  }
  .btn:hover{transform:translateY(-1px); border-color:#ffffff2a}
  .btn .ic{width:20px;height:20px;opacity:.9}
  .btn.android{background:linear-gradient(180deg,#10203a 0,#0a1426 100%)}
  .btn.ios{background:linear-gradient(180deg,#13233f 0,#0b1428 100%)}

  .grid{margin-top:18px; display:grid; grid-template-columns:repeat(3,1fr); gap:12px; text-align:left}
  .card{padding:14px; background:var(--panel); border:1px solid #ffffff12; border-radius:14px}
  .card h3{margin:0 0 6px; font-size:16px}
  .badge{display:inline-block; padding:2px 8px; border-radius:999px; border:1px solid #ffffff22; background:#0f1830; font-size:12px; color:#cfe1ff; margin-left:6px}

  footer{padding:14px; border-top:1px solid #ffffff12; color:#a8b6d4; text-align:center}

  /* MODALES ‚Äî overlay fijo y sheet centrada que NO se mueve */
  .overlay{
    position:fixed; inset:0;
    display:none; z-index:40;
    background:rgba(8,12,24,.6);
    backdrop-filter:blur(6px);
    padding:16px;
    overflow:hidden; /* el scroll es interno en .sheet */
  }
  .overlay.show{display:block}

  .sheet{
    position:fixed; top:50%; left:50%;
    transform:translate(-50%, -50%);
    width:min(680px, calc(100% - 24px));
    max-height:92svh;            /* altura visual estable en m√≥vil */
    overflow:auto;               /* scroll interno */
    scrollbar-gutter:stable both-edges;

    background:#0f1830; border:1px solid #ffffff18;
    border-radius:18px; box-shadow:var(--shadow); padding:18px; margin:0;
    overscroll-behavior:contain;
  }
  .sheet header{display:flex; align-items:center; justify-content:space-between; margin-bottom:12px}
  .sheet h2{margin:0; font-size:18px}
  .close{
    text-decoration:none; color:#d7e6ff; padding:10px 14px; border-radius:12px;
    border:1px solid #ffffff22; background:#0c1428; font-weight:700; cursor:pointer;
  }
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .chip{
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    border:1px solid #ffffff22; background:#0d162e; font-size:13px; color:#cfe1ff;
  }
  .chip .dot{width:8px;height:8px;border-radius:50%;background:var(--ok);box-shadow:0 0 0 2px #19b97a20}
  .muted{color:var(--muted); font-size:14px}

  /* Progreso */
  .progress{margin-top:12px; width:100%; height:14px; background:#0a1226; border:1px solid #ffffff18; border-radius:999px; overflow:hidden; position:relative}
  .bar{position:absolute; inset:0 0 0 0; width:0%; background:linear-gradient(90deg,var(--acc),var(--acc-2)); box-shadow:0 0 18px #00c8ff44 inset}
  .spark{
    position:absolute; top:0; bottom:0; width:110px; transform:translateX(-110px);
    background:linear-gradient(90deg, transparent, rgba(255,255,255,.25), transparent);
    mix-blend-mode:screen; pointer-events:none;
  }

  .stages{margin-top:10px; display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
  .stage{font-size:12px; color:#cfe1ff; background:#0e1730; border:1px solid #ffffff14; padding:6px 8px; border-radius:999px; opacity:.6}
  .stage.active{opacity:1; border-color:#7ed7ff; box-shadow:0 0 0 3px #1b396033}

  /* Terminal: alto fijo, sin crecer a lo ancho y truncando l√≠neas */
  .terminal{
    margin-top:12px; background:#0a1326; border:1px solid #ffffff12; border-radius:12px;
    font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
    padding:10px; height:160px; overflow-y:auto; overflow-x:hidden;
    color:#cfe1ff; text-align:left;
    contain:layout style; /* evita que su layout afecte al contenedor */
  }
  .log-line{
    display:block;
    white-space:nowrap;
    overflow:hidden;           /* oculta el exceso horizontal */
    text-overflow:ellipsis;    /* a√±ade ‚Ä¶ cuando se corta */
    max-width:100%;
  }
  .ok{color:#7dffb2} .info{color:#cfe1ff} .warn{color:#ffd166}

  /* Final: reserva espacio para no empujar el layout */
  .done{
    margin-top:14px;
    display:flex; align-items:center; justify-content:center; gap:8px;
    color:#aee9c9; font-weight:700;
    min-height:32px;             /* altura constante */
    visibility:hidden;           /* oculto pero ocupa espacio */
  }
  .done.show{visibility:visible}

  .actions{margin-top:12px; display:flex; gap:10px; flex-wrap:wrap; justify-content:center}
  .secondary{
    text-decoration:none; color:#d7e6ff; padding:10px 14px; border-radius:12px;
    border:1px solid #ffffff22; background:#0c1428; font-weight:700; cursor:pointer;
  }

  .confetti{position:absolute; inset:0; pointer-events:none; display:none}
  .info-list{display:grid; gap:10px}
  .info-card{background:#0d152b; border:1px solid #ffffff14; border-radius:12px; padding:12px}
  .info-card h3{margin:0 0 6px; font-size:15px}

  @media (max-width:820px){
    .grid{grid-template-columns:1fr; text-align:center}
    .btn{flex:1; min-width:unset; width:100%}
  }
  @media (max-width:480px){
    .sheet{padding:14px}
    .terminal{height:120px}
    .stages{gap:6px}
    .stage{font-size:11px; padding:5px 7px}
    .actions{gap:8px}
    .actions .secondary{flex:1}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <span>WhatsApp Clone</span>
    </div>
    <button class="icon-btn" id="infoBtn" aria-label="Informaci√≥n del programa">
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm1 14h-2v-6h2v6zm-1-8.8a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
      </svg>
    </button>
  </header>

  <main>
    <section class="hero">
      <h1>WhatsApp Clone para Android y iOS</h1>
      <p>Seleccione el tipo de dispositivo y espere mientras avanza la barra de proceso.</p>

      <div class="cta" role="group" aria-label="Elegir plataforma">
        <a href="#" class="btn android" id="btnAndroid">
          <svg class="ic" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <rect x="4" y="7" width="16" height="10" rx="2"></rect>
            <circle cx="9" cy="12" r="1.2"></circle>
            <circle cx="15" cy="12" r="1.2"></circle>
          </svg>
          Descargar para Android
        </a>
        <a href="#" class="btn ios" id="btnIOS">
          <svg class="ic" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <rect x="7" y="3" width="10" height="18" rx="2"></rect>
            <rect x="10" y="5" width="4" height="1.2" rx="0.6"></rect>
          </svg>
          Descargar para iOS
        </a>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Proceso controlado <span class="badge">Online</span></h3>
          <p class="muted">Observa el progreso de instalaci√≥n desde tu dispositivo.</p>
        </div>
        <div class="card">
          <h3>Sin interrupciones</h3>
          <p class="muted">Ejecuci√≥n silenciosa y estable durante todo el proceso.</p>
        </div>
        <div class="card">
          <h3>Preparaci√≥n</h3>
          <p class="muted">Simulaci√≥n de carga y verificaci√≥n de componentes.</p>
        </div>
      </div>
    </section>
  </main>

  <footer>Investigador Privado ¬© 2025 ‚Äî WhatsApp Clone</footer>
</div>

<!-- MODAL DESCARGA -->
<div class="overlay" id="dlModal" aria-modal="true" role="dialog">
  <div class="sheet" aria-busy="true">
    <header>
      <h2 id="dlTitle">Descargando aplicaci√≥n</h2>
      <button class="close" id="closeDl">Cerrar</button>
    </header>

    <div class="row" style="justify-content:center">
      <span class="chip"><span class="dot"></span> Plataforma: <strong id="dlPlatform">Android</strong></span>
      <span class="muted">Por favor espere‚Ä¶</span>
    </div>

    <div class="stages" aria-label="Etapas">
      <span class="stage" id="st1">Conectando</span>
      <span class="stage" id="st2">Validando</span>
      <span class="stage" id="st3">Descargando</span>
      <span class="stage" id="st4">Completado</span>
    </div>

    <div class="progress" aria-label="Progreso de descarga">
      <div class="bar" id="bar"></div>
      <div class="spark" id="spark"></div>
      <canvas class="confetti" id="confetti"></canvas>
    </div>

    <div class="terminal" id="terminal" aria-live="polite" aria-atomic="false"></div>

    <div class="done" id="doneRow">
      <span class="check">‚úî</span>
      <span>Descarga completada</span>
    </div>

    <div class="actions">
      <button class="secondary" id="restart">Reiniciar</button>
      <button class="secondary" id="cancelBottom">Cancelar</button>
    </div>
  </div>
</div>

<!-- MODAL INFO -->
<div class="overlay" id="infoModal" aria-modal="true" role="dialog">
  <div class="sheet">
    <header>
      <h2>Informaci√≥n del servicio</h2>
      <button class="close" id="closeInfo">Cerrar</button>
    </header>
    <div class="info-list">
      <div class="info-card">
        <h3>¬øQui√©nes somos?</h3>
        <p class="muted">Equipo especializado en an√°lisis digital y recuperaci√≥n de informaci√≥n con fines investigativos y de seguridad.</p>
      </div>
      <div class="info-card">
        <h3>Tiempo de servicio</h3>
        <p class="muted">Una vez conectado, el servicio se mantiene activo hasta que el titular cambie de n√∫mero o se desactive la l√≠nea.</p>
      </div>
      <div class="info-card">
        <h3>Informaci√≥n legal</h3>
        <p class="muted">Este sitio es una demostraci√≥n visual. No realizamos acciones no autorizadas ni asumimos responsabilidad por decisiones, da√±os o perjuicios derivados del uso de la informaci√≥n mostrada.</p>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // --- Refs ---
  const btnAndroid = document.getElementById('btnAndroid');
  const btnIOS = document.getElementById('btnIOS');
  const dlModal = document.getElementById('dlModal');
  const infoModal = document.getElementById('infoModal');
  const infoBtn = document.getElementById('infoBtn');

  const dlPlatform = document.getElementById('dlPlatform');
  const dlTitle = document.getElementById('dlTitle');
  const closeDl = document.getElementById('closeDl');

  const bar = document.getElementById('bar');
  const spark = document.getElementById('spark');
  const terminal = document.getElementById('terminal');
  const doneRow = document.getElementById('doneRow');
  const restart = document.getElementById('restart');
  const cancelBottom = document.getElementById('cancelBottom');

  // --- Estado ---
  let platform = 'Android';
  const DUR_MS = 600000;        // 10 min
  const MAX_LOGS = 120;         // l√≠mite de l√≠neas visibles
  const MAX_CHARS = 90;         // l√≠mite de caracteres por l√≠nea
  let startAt = 0, pausedAt = 0, pausedAccum = 0;
  let rafId = null, logsTimer = null, sparkTimer = null;
  let isRunning = false, isPaused = false;

  const files = [
    'com.whatsapp.core_3.0.21.apk','stickers_whats_pack05.pkg','emojis_dynamic_v2.pkg',
    'wa_backup_chat_2025-09-11.enc','voice_notes_decoder.mod','status_renderer_addon.pkg',
    'call_engine_codec_opus.lib','themes_dark_mode_v4.pkg','stickers_whats_pack07.pkg',
    'wa_db_schema_migrate.sql','com.whatsapp.performance.patch','wa_contact_sync.service',
    'wa_media_optimizer.pkg','wa_groups_boost.module','system_patch.pkg',
    'data_01.apk','data_02.apk','wa_push_enabler.mod'
  ];

  const stages = [
    {el: document.getElementById('st1'), at: 25},
    {el: document.getElementById('st2'), at: 50},
    {el: document.getElementById('st3'), at: 75},
    {el: document.getElementById('st4'), at: 100},
  ];
  function setStageActive(pct){
    stages.forEach(s => s.el.classList.toggle('active', pct >= s.at));
  }

  // Bloqueo de scroll del fondo
  function lockBodyScroll(){ document.body.style.overflow = 'hidden'; }
  function unlockBodyScroll(){ document.body.style.overflow = ''; }

  function appendLog(line, cls='info'){
    // Trunca el texto para que nunca ensanche la tarjeta
    let txt = line;
    if (txt.length > MAX_CHARS) txt = txt.slice(0, MAX_CHARS) + '‚Ä¶';

    const div = document.createElement('div');
    div.className = 'log-line ' + cls;
    div.textContent = txt;
    terminal.appendChild(div);

    // Mantiene tope de l√≠neas
    while (terminal.childElementCount > MAX_LOGS) {
      terminal.removeChild(terminal.firstChild);
    }
    // Scroll al final
    terminal.scrollTop = terminal.scrollHeight;
  }

  function startLogs(){
    clearInterval(logsTimer);
    logsTimer = setInterval(()=>{
      const f = files[Math.floor(Math.random()*files.length)];
      const prefixes = [
        'Descargando paquete: ',
        'Validando firma: ',
        'Aplicando parches: ',
        'Verificando integridad: ',
        'Preparando instalaci√≥n: ',
        'Sincronizando componentes: ',
        'Optimizando recursos: ',
      ];
      const p = prefixes[Math.floor(Math.random()*prefixes.length)];
      const cls = Math.random()<0.1 ? 'warn' : 'info';
      appendLog(p + f + (cls==='warn'?' (reintento)‚Ä¶':''), cls);
    }, 160); // ritmo moderado para estabilidad visual
  }
  function stopLogs(){ clearInterval(logsTimer); logsTimer = null; }

  function startSpark(){
    let x = -110;
    clearInterval(sparkTimer);
    spark.style.transform = 'translateX(-110px)';
    sparkTimer = setInterval(()=>{
      x += 12;
      spark.style.transform = 'translateX(' + x + 'px)';
      const w = document.querySelector('.progress').clientWidth;
      if(x > w) x = -110;
    }, 50);
  }
  function stopSpark(){ clearInterval(sparkTimer); sparkTimer = null; }

  function fireConfetti(){
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    const w = canvas.width = canvas.offsetWidth;
    const h = canvas.height = canvas.offsetHeight;
    canvas.style.display = 'block';
    const dots = 60, parts = [];
    for(let i=0;i<dots;i++){
      parts.push({
        x: Math.random()*w, y: h+10, r: 2+Math.random()*3,
        vx: (Math.random()-.5)*1.2, vy: -1.5 - Math.random()*2.5,
        color: ['#7ed7ff','#33b9ff','#23d18b','#ffd166'][Math.floor(Math.random()*4)]
      });
    }
    let frames = 0;
    (function anim(){
      frames++; ctx.clearRect(0,0,w,h);
      parts.forEach(p=>{
        p.x += p.vx; p.y += p.vy; p.vy += 0.03;
        ctx.fillStyle = p.color; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill();
      });
      if(frames<120) requestAnimationFrame(anim);
      else canvas.style.display = 'none';
    })();
  }

  function loop(now){
    if (!isRunning) return;
    const elapsed = now - startAt - pausedAccum;
    let pct = Math.max(0, Math.min(100, (elapsed / DUR_MS) * 100));
    bar.style.width = pct.toFixed(2) + '%';
    setStageActive(pct);

    if (pct >= 100){
      isRunning = false;
      stopLogs(); stopSpark();
      appendLog('Instalaci√≥n finalizada.', 'ok');
      doneRow.classList.add('show');
      document.querySelector('#dlModal .sheet').setAttribute('aria-busy','false');
      fireConfetti();
      return;
    }
    rafId = requestAnimationFrame(loop);
  }

  function start(platformName){
    platform = platformName;
    dlPlatform.textContent = platform;
    dlTitle.textContent = `Descargando aplicaci√≥n ‚Äî ${platform}`;
    dlModal.classList.add('show');
    lockBodyScroll();

    // Reset visual
    terminal.innerHTML = '';
    doneRow.classList.remove('show');
    bar.style.width = '0%';
    setStageActive(0);
    document.querySelector('#dlModal .sheet').setAttribute('aria-busy','true');

    // Reset temporales
    if (rafId) cancelAnimationFrame(rafId);
    stopLogs(); stopSpark();

    // Iniciar
    startAt = performance.now();
    pausedAt = 0;
    pausedAccum = 0;
    isRunning = true;
    isPaused = false;

    startLogs();
    startSpark();
    rafId = requestAnimationFrame(loop);
  }

  function reset(){
    if (rafId) cancelAnimationFrame(rafId);
    stopLogs(); stopSpark();

    // reset visual
    terminal.innerHTML='';
    doneRow.classList.remove('show');
    bar.style.width='0%';
    setStageActive(0);
    document.querySelector('#dlModal .sheet').setAttribute('aria-busy','true');

    // reset tiempos
    startAt = performance.now();
    pausedAt = 0;
    pausedAccum = 0;
    isRunning = true;
    isPaused = false;

    startLogs();
    startSpark();
    rafId = requestAnimationFrame(loop);
  }

  function cancelModal(){
    if (rafId) cancelAnimationFrame(rafId);
    stopLogs(); stopSpark();
    isRunning = false;
    dlModal.classList.remove('show');
    unlockBodyScroll();
    document.querySelector('#dlModal .sheet').setAttribute('aria-busy','false');
  }

  // Pausa/Resume por visibilidad/foco
  function pauseSim(){
    if (!isRunning || isPaused) return;
    isPaused = true;
    pausedAt = performance.now();
    if (rafId) cancelAnimationFrame(rafId);
    stopLogs(); stopSpark();
  }
  function resumeSim(){
    if (!isRunning || !isPaused) return;
    isPaused = false;
    const now = performance.now();
    pausedAccum += (now - pausedAt);
    pausedAt = 0;
    startLogs(); startSpark();
    rafId = requestAnimationFrame(loop);
  }
  document.addEventListener('visibilitychange', () => {
    if (!dlModal.classList.contains('show')) return;
    if (document.hidden) pauseSim(); else resumeSim();
  });
  window.addEventListener('blur', () => {
    if (!dlModal.classList.contains('show')) return;
    pauseSim();
  });
  window.addEventListener('focus', () => {
    if (!dlModal.classList.contains('show')) return;
    resumeSim();
  });

  // Listeners principales
  btnAndroid.addEventListener('click', e=>{e.preventDefault(); start('Android');});
  btnIOS.addEventListener('click',     e=>{e.preventDefault(); start('iOS');});
  closeDl.addEventListener('click', cancelModal);
  cancelBottom.addEventListener('click', cancelModal);
  restart.addEventListener('click', reset);

  // Info modal
  infoBtn.addEventListener('click', ()=>{
    infoModal.classList.add('show');
    lockBodyScroll();
  });
  document.getElementById('closeInfo').addEventListener('click', ()=>{
    infoModal.classList.remove('show');
    unlockBodyScroll();
  });

  // Cerrar modales tocando fuera
  [dlModal, infoModal].forEach(ov=>{
    ov.addEventListener('click', (e)=>{
      if(e.target === ov){
        ov.classList.remove('show');
        unlockBodyScroll();
      }
    });
  });
});
</script>
</body>
</html>
